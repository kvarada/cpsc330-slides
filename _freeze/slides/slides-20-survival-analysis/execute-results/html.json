{
  "hash": "0c2401932f4c91ea14a4dc76ac9f7724",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"CPSC 330 Lecture 20: Survival analysis\"\nauthor: \"Varada Kolhatkar\"\nformat: \n    revealjs:\n      html-math-method: mathjax    \n      embed-resources: true\n      slide-number: true\n      logo: img/UBC-CS-logo.png\n      resources:\n        - data/\n        - img/        \n---\n\n\n\n## Focus on the breath!\n\n![](img/inukshuk.jpeg){.nostretch fig-align=\"center\" width=\"500px\"}\n\n## Announcements\n\n- HW9 has been released (due next week Monday)\n  - Almost there! You‚Äôve got this! üòä\n- Midterm 2 grades were released last week. \n\n## Recap: iClicker questions {.smaller}\n### (iClicker) Exercise 20.1 \n\n**Select all of the following statements which are TRUE.**\n\n- (A) We need to be careful when splitting the data when working with time series data.\n- (B) Cross-validation in time series can be randomly applied like in other machine learning tasks.\n- (C) In time series forecasting, the future value of a series can only be predicted based on its past values and cannot incorporate other variables.\n- (D) When we used `RandomForestRegressor` model on the POSIX time feature, it predicted a straight line on the test data because tree-based models are inherently unable to extrapolate (i.e., make predictions outside the range of the training data).\n\n\n## Customer churn \n\nCustomer churn, also known as customer attrition, refers to the phenomenon where customers or subscribers stop doing business with a company or service.\n\n## Monthly subscriber churn rates for various streaming services\n\n:::: {.columns}\n:::{.column width=\"50%\"}\n![](img/subscriber-churn.png)\n[Source](https://sherwood.news/tech/could-mergers-help-streaming-sites-turn-the-churning-tides/)\n::: \n\n:::{.column width=\"50%\"}\n\n**Question:** Is a smaller or a larger churn rate more desirable for a subscription-based company?\n\n- A smaller churn rate is better (means fewer customers leaving)\n- Lower churn = higher customer retention = more stable revenue\n\n:::\n::::\n\n## The challenge: Predicting *when*, not just *whether*\n\nImagine you work for a subscription-based telecom company.\n\n- Your team wants to predict **when a customer will churn**, not just whether they churn.\n- This helps the company:\n  - Target retention strategies at the right time\n  - Allocate resources efficiently to high-risk customers\n  - Understand which factors accelerate or delay churn\n- Our goal: **model time to churn** while accounting for customers who haven't churned yet.\n\n## [Customer Churn Dataset](https://www.kaggle.com/blastchar/telco-customer-churn) {.scrollable .smaller}\n\nIf you wanted to predict whether a customer churns, what kind of model from your ML toolbox would you use?\n\n::: {#bfca7107 .cell execution_count=2}\n\n::: {.cell-output .cell-output-display execution_count=2}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>customerID</th>\n      <th>gender</th>\n      <th>SeniorCitizen</th>\n      <th>Partner</th>\n      <th>Dependents</th>\n      <th>tenure</th>\n      <th>PhoneService</th>\n      <th>MultipleLines</th>\n      <th>InternetService</th>\n      <th>OnlineSecurity</th>\n      <th>...</th>\n      <th>DeviceProtection</th>\n      <th>TechSupport</th>\n      <th>StreamingTV</th>\n      <th>StreamingMovies</th>\n      <th>Contract</th>\n      <th>PaperlessBilling</th>\n      <th>PaymentMethod</th>\n      <th>MonthlyCharges</th>\n      <th>TotalCharges</th>\n      <th>Churn</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>6464</th>\n      <td>4726-DLWQN</td>\n      <td>Male</td>\n      <td>1</td>\n      <td>No</td>\n      <td>No</td>\n      <td>50</td>\n      <td>Yes</td>\n      <td>Yes</td>\n      <td>DSL</td>\n      <td>Yes</td>\n      <td>...</td>\n      <td>No</td>\n      <td>No</td>\n      <td>Yes</td>\n      <td>No</td>\n      <td>Month-to-month</td>\n      <td>Yes</td>\n      <td>Bank transfer (automatic)</td>\n      <td>70.35</td>\n      <td>3454.6</td>\n      <td>No</td>\n    </tr>\n    <tr>\n      <th>5707</th>\n      <td>4537-DKTAL</td>\n      <td>Female</td>\n      <td>0</td>\n      <td>No</td>\n      <td>No</td>\n      <td>2</td>\n      <td>Yes</td>\n      <td>No</td>\n      <td>DSL</td>\n      <td>No</td>\n      <td>...</td>\n      <td>No</td>\n      <td>No</td>\n      <td>No</td>\n      <td>No</td>\n      <td>Month-to-month</td>\n      <td>No</td>\n      <td>Electronic check</td>\n      <td>45.55</td>\n      <td>84.4</td>\n      <td>No</td>\n    </tr>\n    <tr>\n      <th>3442</th>\n      <td>0468-YRPXN</td>\n      <td>Male</td>\n      <td>0</td>\n      <td>No</td>\n      <td>No</td>\n      <td>29</td>\n      <td>Yes</td>\n      <td>No</td>\n      <td>Fiber optic</td>\n      <td>No</td>\n      <td>...</td>\n      <td>Yes</td>\n      <td>Yes</td>\n      <td>Yes</td>\n      <td>Yes</td>\n      <td>Month-to-month</td>\n      <td>Yes</td>\n      <td>Credit card (automatic)</td>\n      <td>98.80</td>\n      <td>2807.1</td>\n      <td>No</td>\n    </tr>\n    <tr>\n      <th>3932</th>\n      <td>1304-NECVQ</td>\n      <td>Female</td>\n      <td>1</td>\n      <td>No</td>\n      <td>No</td>\n      <td>2</td>\n      <td>Yes</td>\n      <td>Yes</td>\n      <td>Fiber optic</td>\n      <td>No</td>\n      <td>...</td>\n      <td>Yes</td>\n      <td>No</td>\n      <td>No</td>\n      <td>No</td>\n      <td>Month-to-month</td>\n      <td>Yes</td>\n      <td>Electronic check</td>\n      <td>78.55</td>\n      <td>149.55</td>\n      <td>Yes</td>\n    </tr>\n    <tr>\n      <th>6124</th>\n      <td>7153-CHRBV</td>\n      <td>Female</td>\n      <td>0</td>\n      <td>Yes</td>\n      <td>Yes</td>\n      <td>57</td>\n      <td>Yes</td>\n      <td>No</td>\n      <td>DSL</td>\n      <td>Yes</td>\n      <td>...</td>\n      <td>Yes</td>\n      <td>Yes</td>\n      <td>No</td>\n      <td>No</td>\n      <td>One year</td>\n      <td>Yes</td>\n      <td>Mailed check</td>\n      <td>59.30</td>\n      <td>3274.35</td>\n      <td>No</td>\n    </tr>\n  </tbody>\n</table>\n<p>5 rows √ó 21 columns</p>\n</div>\n```\n:::\n:::\n\n\n## Churn prediction as binary classification\n\n- When we treat churn as a binary classification problem, we only ask: **Has the customer churned by the time of data collection?**\n\n- Limitations of this approach:\n  - Answers only \"Yes/No\" and discards **when** churn occurred\n  - Treats a customer who churned after 1 month the same as one who churned after 5 years\n  - Ignores the time dimension entirely\n\n- **Is that what we want?** Not if timing matters for business decisions! \n\n## Predicting tenure\n\n:::: {.columns}\n:::{.column width=\"40%\"}\n\n::: {#dfa917da .cell execution_count=3}\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>tenure</th>\n      <th>Churn</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>6464</th>\n      <td>50</td>\n      <td>No</td>\n    </tr>\n    <tr>\n      <th>5707</th>\n      <td>2</td>\n      <td>No</td>\n    </tr>\n    <tr>\n      <th>3442</th>\n      <td>29</td>\n      <td>No</td>\n    </tr>\n    <tr>\n      <th>3932</th>\n      <td>2</td>\n      <td>Yes</td>\n    </tr>\n    <tr>\n      <th>6124</th>\n      <td>57</td>\n      <td>No</td>\n    </tr>\n    <tr>\n      <th>301</th>\n      <td>4</td>\n      <td>Yes</td>\n    </tr>\n    <tr>\n      <th>3552</th>\n      <td>68</td>\n      <td>No</td>\n    </tr>\n    <tr>\n      <th>2874</th>\n      <td>64</td>\n      <td>No</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n:::\n:::{.column width=\"60%\"}\n\nIn our dataset, the tenure column is the number of months the customer has stayed with the company. Can we use the techniques you learned so far (e.g., regression models) to predict the time (tenure in our case)? \n:::\n::::\n\n## The problem: Incomplete information\n\n:::: {.columns}\n:::{.column width=\"40%\"}\n\n::: {#45f6db11 .cell execution_count=4}\n\n::: {.cell-output .cell-output-display execution_count=4}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>tenure</th>\n      <th>Churn</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>6464</th>\n      <td>50</td>\n      <td>No</td>\n    </tr>\n    <tr>\n      <th>5707</th>\n      <td>2</td>\n      <td>No</td>\n    </tr>\n    <tr>\n      <th>3442</th>\n      <td>29</td>\n      <td>No</td>\n    </tr>\n    <tr>\n      <th>3932</th>\n      <td>2</td>\n      <td>Yes</td>\n    </tr>\n    <tr>\n      <th>6124</th>\n      <td>57</td>\n      <td>No</td>\n    </tr>\n    <tr>\n      <th>301</th>\n      <td>4</td>\n      <td>Yes</td>\n    </tr>\n    <tr>\n      <th>3552</th>\n      <td>68</td>\n      <td>No</td>\n    </tr>\n    <tr>\n      <th>2874</th>\n      <td>64</td>\n      <td>No</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n:::\n:::{.column width=\"60%\"}\n- We only have information about tenure **up to the point we collected the data**. \n- For customers who haven't churned:\n  - We don't know their true \"time to churn\"\n  - We only know they lasted **at least** this long\n  - Their actual churn time is unknown (incomplete information)\n- This is called **right-censoring** - the event hasn't occurred yet\n:::\n::::\n\n## Types of censoring {.smaller}\n- **Right-censoring**: Event hasn't occurred yet (most common in practice)\n- **Left-censoring**: Event occurred before observation started\n- **Interval-censoring**: Event occurred within a time interval\n\n![](img/censoring.png)\n\n## Time to event and censoring \n\n:::: {.columns}\n:::{.column width=\"40%\"}\n\n::: {#c9279e31 .cell execution_count=5}\n\n::: {.cell-output .cell-output-display execution_count=5}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>tenure</th>\n      <th>Churn</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>6464</th>\n      <td>50</td>\n      <td>No</td>\n    </tr>\n    <tr>\n      <th>5707</th>\n      <td>2</td>\n      <td>No</td>\n    </tr>\n    <tr>\n      <th>3442</th>\n      <td>29</td>\n      <td>No</td>\n    </tr>\n    <tr>\n      <th>3932</th>\n      <td>2</td>\n      <td>Yes</td>\n    </tr>\n    <tr>\n      <th>6124</th>\n      <td>57</td>\n      <td>No</td>\n    </tr>\n    <tr>\n      <th>301</th>\n      <td>4</td>\n      <td>Yes</td>\n    </tr>\n    <tr>\n      <th>3552</th>\n      <td>68</td>\n      <td>No</td>\n    </tr>\n    <tr>\n      <th>2874</th>\n      <td>64</td>\n      <td>No</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n:::\n:::{.column width=\"60%\"}\n- Many customers in the dataset are still active (Churn = \"No\"). \n- They are **right-censored**: we only know their tenure **so far**, not their final tenure. \n:::\n::::\n\n\n## Time-to-event problems\n\nTime-to-event problems appear everywhere. Examples include:\n\n- Time until a customer leaves a subscription service\n- Time until a disease causes death\n- Time until equipment fails\n- Duration of unemployment until finding a job\n- Waiting time until a scheduled surgery\n\nThese all follow the same pattern: the event happens once, and we care about how long it takes.\n\n\n# Approaches \n\n## Approach 1: Only use churned customers ‚õîÔ∏è {.smaller}\n\nSuppose we only consider rows where Churn == \"Yes\" and throw away all right-censored customers. \n\n::: {#ea53365c .cell execution_count=6}\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>customerID</th>\n      <th>gender</th>\n      <th>SeniorCitizen</th>\n      <th>Partner</th>\n      <th>Dependents</th>\n      <th>tenure</th>\n      <th>PhoneService</th>\n      <th>MultipleLines</th>\n      <th>InternetService</th>\n      <th>OnlineSecurity</th>\n      <th>...</th>\n      <th>DeviceProtection</th>\n      <th>TechSupport</th>\n      <th>StreamingTV</th>\n      <th>StreamingMovies</th>\n      <th>Contract</th>\n      <th>PaperlessBilling</th>\n      <th>PaymentMethod</th>\n      <th>MonthlyCharges</th>\n      <th>TotalCharges</th>\n      <th>Churn</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>3932</th>\n      <td>1304-NECVQ</td>\n      <td>Female</td>\n      <td>1</td>\n      <td>No</td>\n      <td>No</td>\n      <td>2</td>\n      <td>Yes</td>\n      <td>Yes</td>\n      <td>Fiber optic</td>\n      <td>No</td>\n      <td>...</td>\n      <td>Yes</td>\n      <td>No</td>\n      <td>No</td>\n      <td>No</td>\n      <td>Month-to-month</td>\n      <td>Yes</td>\n      <td>Electronic check</td>\n      <td>78.55</td>\n      <td>149.55</td>\n      <td>Yes</td>\n    </tr>\n    <tr>\n      <th>301</th>\n      <td>8098-LLAZX</td>\n      <td>Female</td>\n      <td>1</td>\n      <td>No</td>\n      <td>No</td>\n      <td>4</td>\n      <td>Yes</td>\n      <td>Yes</td>\n      <td>Fiber optic</td>\n      <td>No</td>\n      <td>...</td>\n      <td>No</td>\n      <td>No</td>\n      <td>Yes</td>\n      <td>Yes</td>\n      <td>Month-to-month</td>\n      <td>Yes</td>\n      <td>Electronic check</td>\n      <td>95.45</td>\n      <td>396.1</td>\n      <td>Yes</td>\n    </tr>\n    <tr>\n      <th>5540</th>\n      <td>3803-KMQFW</td>\n      <td>Female</td>\n      <td>0</td>\n      <td>Yes</td>\n      <td>Yes</td>\n      <td>1</td>\n      <td>Yes</td>\n      <td>No</td>\n      <td>No</td>\n      <td>No internet service</td>\n      <td>...</td>\n      <td>No internet service</td>\n      <td>No internet service</td>\n      <td>No internet service</td>\n      <td>No internet service</td>\n      <td>Month-to-month</td>\n      <td>No</td>\n      <td>Mailed check</td>\n      <td>20.55</td>\n      <td>20.55</td>\n      <td>Yes</td>\n    </tr>\n    <tr>\n      <th>4084</th>\n      <td>2777-PHDEI</td>\n      <td>Female</td>\n      <td>0</td>\n      <td>No</td>\n      <td>No</td>\n      <td>1</td>\n      <td>Yes</td>\n      <td>No</td>\n      <td>Fiber optic</td>\n      <td>No</td>\n      <td>...</td>\n      <td>No</td>\n      <td>No</td>\n      <td>Yes</td>\n      <td>No</td>\n      <td>Month-to-month</td>\n      <td>No</td>\n      <td>Electronic check</td>\n      <td>78.05</td>\n      <td>78.05</td>\n      <td>Yes</td>\n    </tr>\n  </tbody>\n</table>\n<p>4 rows √ó 21 columns</p>\n</div>\n```\n:::\n:::\n\n\nThis throws away valuable information from active customers!\n\n## iClicker \n\nWould only considering rows where Churn == \"Yes\" and throwing away all right-censored customers overestimate or underestimate the average survival time?\n\n- (A) Overestimate \n- (B) Underestimate \n- (C) Cannot tell based on the provided information\n\n\n## Approach 2: Assume everyone churns now ‚õîÔ∏è\n\nTreat all current tenure values as final, even for active customers.\n\n::: {#9a91b291 .cell execution_count=7}\n\n::: {.cell-output .cell-output-display execution_count=7}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>tenure</th>\n      <th>Churn</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>6464</th>\n      <td>50</td>\n      <td>No</td>\n    </tr>\n    <tr>\n      <th>5707</th>\n      <td>2</td>\n      <td>No</td>\n    </tr>\n    <tr>\n      <th>3442</th>\n      <td>29</td>\n      <td>No</td>\n    </tr>\n    <tr>\n      <th>3932</th>\n      <td>2</td>\n      <td>Yes</td>\n    </tr>\n    <tr>\n      <th>6124</th>\n      <td>57</td>\n      <td>No</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nThis assumes active customers (Churn = \"No\") will churn immediately. \n\n## iClicker \n\nWould assuming everyone churns now underestimate or overestimate tenure?\n\n- (A) Overestimate \n- (B) Underestimate \n- (C) Cannot tell based on the provided information\n\n\n## \n\n- **Key insight**: Ignoring or removing censored cases will bias our estimates:\n\n## Approach 3: Survival analysis ‚úÖ\n\nSurvival analysis explicitly models time until an event **and properly handles censoring**.\n\n**Common methods:**\n\n- **Kaplan‚ÄìMeier estimator**: Non-parametric method for estimating survival curves\n- **Cox proportional hazards model**: Semi-parametric regression model for survival data\n- **Survival forests**: Random forest variant adapted for censored data\n\n## Survival analysis\n\nThese methods allow estimation of:\n\n- **Survival function**: $S(t) = P(T > t)$ (probability of surviving past time $t$)\n- **Hazard function**: $h(t)$ (instantaneous risk of the event at time $t$)\n\n## iClicker \n\n**Select all of the following statements which are TRUE.**\n\n- (A) Right censoring occurs when the endpoint of event has not been observed for all study subjects by the end of the study period.\n- (B) Right censoring implies that the data is missing completely at random.\n- (C) In the presence of right-censored data, binary classification models can be applied directly without any modifications or special considerations.\n- (D) If we apply the `Ridge` regression model to predict tenure in right censored data, we are likely to underestimate it because the tenure observed in our data is shorter than what it would be in reality.\n\n\n\n# [Class demo](https://github.com/UBC-CS/cpsc330-2025W1/blob/main/lectures/102-Varada-lectures/class_demos/demo_20-survival-analysis.ipynb) \n\n\n## What did we learn today? \n\n- Censoring and incorrect approaches to handling it\n  - Throw away people who haven't churned\n  - Assume everyone churns today\n- Predicting tenure vs. churned\n- Survival analysis encompasses both of these, and deals with censoring\n- And it can make rich and interesting predictions!\n- KM model -> doesn't look at features\n- CPH model -> like linear regression, does look at the features\n\n",
    "supporting": [
      "slides-20-survival-analysis_files/figure-revealjs"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}